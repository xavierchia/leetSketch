<!--
* Refactor code so both canvases get loaded
* Move clear to left
* Move save to right
* Rename save to Done Drawing!
* Add step numbers
* Save image on the right side immediately
* Hide/Unhide Photo button on the right side
* Next Photo button that cycles through images

* Add grid to both sides 6x6

* Upload own photo

-->

<html>
  <script type="text/javascript">
  var canvas, ctx, flag = false,
      prevX = 0,
      currX = 0,
      prevY = 0,
      currY = 0

  var penColor = "black",
      penSize = 5;
  
  function init() {
      canvas = document.getElementById('canDraw');
      ctx = canvas.getContext("2d");
      w = canvas.width;
      h = canvas.height;
  
      canvas.addEventListener("mousemove", function (e) {
          findxy('move', e)
      }, false);
      canvas.addEventListener("mousedown", function (e) {
          findxy('down', e)
      }, false);
      canvas.addEventListener("mouseup", function (e) {
          findxy('up', e)
      }, false);
      canvas.addEventListener("mouseout", function (e) {
          findxy('out', e)
      }, false);
  }
  
  function draw() {
      ctx.beginPath();
      ctx.lineJoin = "round";
      ctx.lineCap = "round";
      ctx.moveTo(prevX, prevY);
      ctx.lineTo(currX, currY);
      ctx.strokeStyle = penColor;
      ctx.lineWidth = penSize;
      ctx.stroke();
      ctx.closePath();
  }
  
  function erase() {
        ctx.clearRect(0, 0, w, h);
        document.getElementById("canvasimg").style.display = "none";
  }
  
  function save() {
      var dataURL = canvas.toDataURL();
      document.getElementById("overlay").src = dataURL;
      document.getElementById("overlay").style.opacity = "0.5";
      document.getElementById("portrait").style.opacity = "0.5";
  }
  
  function findxy(res, e) {
      if (res == 'down' && e.button === 0) {
          prevX = currX;
          prevY = currY;
          currX = e.clientX - canvas.offsetLeft;
          currY = e.clientY - canvas.offsetTop;
  
          flag = true;
          ctx.beginPath();
          ctx.fillStyle = penColor;
          ctx.fillRect(currX, currY, penSize, penSize);
          ctx.closePath();
      }
      if (res == 'up' || res == "out") {
          flag = false;
      }
      if (res == 'move') {
          if (flag) {
              prevX = currX;
              prevY = currY;
              currX = e.clientX - canvas.offsetLeft;
              currY = e.clientY - canvas.offsetTop;
              draw();
          }
      }
  }


  var canvas2, ctx2, flag2 = false,
      prevX2 = 0,
      currX2 = 0,
      prevY2 = 0,
      currY2 = 0

  var penColor2 = "red",
      penSize2 = 5;
  
  function init2() {
      canvas2 = document.getElementById('canEdit');
      ctx2 = canvas2.getContext("2d");
      w2 = canvas2.width;
      h2 = canvas2.height;
  
      canvas2.addEventListener("mousemove", function (e) {
          findxy2('move', e)
      }, false);
      canvas2.addEventListener("mousedown", function (e) {
          findxy2('down', e)
      }, false);
      canvas2.addEventListener("mouseup", function (e) {
          findxy2('up', e)
      }, false);
      canvas2.addEventListener("mouseout", function (e) {
          findxy2('out', e)
      }, false);
  }
  
  function draw2() {
      ctx2.beginPath();
      ctx2.lineJoin = "round";
      ctx2.lineCap = "round";
      ctx2.moveTo(prevX2, prevY2);
      ctx2.lineTo(currX2, currY2);
      ctx2.strokeStyle = penColor2;
      ctx2.lineWidth = penSize2;
      ctx2.stroke();
      ctx2.closePath();
  }
  
  function erase2() {
      if (m) {
          ctx2.clearRect(0, 0, w, h);
      }
  }
  
  function findxy2(res, e) {
      if (res == 'down' && e.button === 0) {
          prevX2 = currX2;
          prevY2 = currY2;
          currX2 = e.clientX - canvas2.offsetLeft;
          currY2 = e.clientY - canvas2.offsetTop;
  
          flag2 = true;
          ctx2.beginPath();
          ctx2.fillStyle = penColor2;
          ctx2.fillRect(currX2, currY2, penSize2, penSize2);
          ctx2.closePath();
      }
      if (res == 'up' || res == "out") {
          flag2 = false;
      }
      if (res == 'move') {
          if (flag2) {
              prevX2 = currX2;
              prevY2 = currY2;
              currX2 = e.clientX - canvas2.offsetLeft;
              currY2 = e.clientY - canvas2.offsetTop;
              draw2();
          }
      }
  }

  function start() {
      init();
      init2();
  }

  </script>
  <body onload="start()">
    <div style="position:absolute;top:50px;left:100px;">1. Draw here:</div>
    <canvas id="canDraw" width="400" height="400" style="position:absolute;top:70px;left:100px;border:2px solid;"></canvas>

    <div style="position:absolute;top:50px;left:700px;">3. Draw corrections</div>
    <img id="portrait" src="portrait1.png" style="position:absolute;top:70px;left:700px; border:2px solid;z-index:0;">
    <img id="overlay" style="position:absolute;top:70px;left:700px;z-index:1;">
    <canvas id="canEdit" width="400" height="400" style="position:absolute;top:70px;left:700px;z-index:5;"></canvas>

    <input type="button" value="2. DONE DRAWING!" id="btn" size="30" onclick="save()" style="position:absolute;top:500px;left:360px;">
    <input type="button" value="Clear" id="clr" size="23" onclick="erase()" style="position:absolute;top:500px;left:100px;">
    
    <input type="button" value="Hide / Unhide Photo" id="clr" size="23" onclick="erase()" style="position:absolute;top:500px;left:700px;">
    <input type="button" value="4. Save Your Masterpiece" id="clr" size="23" onclick="erase()" style="position:absolute;top:500px;left:940px;">
    <input type="button" value="5. Next Photo :)" id="clr" size="23" onclick="erase()" style="position:absolute;top:250px;left:1210px;">
  </body>
  </html>

